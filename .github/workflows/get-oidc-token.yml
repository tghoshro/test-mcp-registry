name: Print Split Token
on: workflow_dispatch

permissions:
  id-token: write
  contents: read

jobs:
  debug-token:
    runs-on: ubuntu-latest
    steps:
      - name: Generate and Split Token
        run: |
          # 1. Fetch Token
          URL="$ACTIONS_ID_TOKEN_REQUEST_URL&audience=my-test-audience"
          TOKEN=$ACTIONS_ID_TOKEN_REQUEST_TOKEN
          RESPONSE=$(curl -s -H "Authorization: bearer $TOKEN" "$URL")
          JWT=$(echo $RESPONSE | jq -r '.value')
          
          echo "âœ… Token Generated."
          echo "I will now print the 3 parts of the token separately."
          echo "To use this in jwt.io, paste Part 1, type a dot (.), paste Part 2, type a dot (.), paste Part 3."
          echo "--------------------------------------------------"
          
          # 2. Split by '.' and print each part
          # We use 'cut' to separate the string by the dots
          PART1=$(echo $JWT | cut -d '.' -f 1)
          PART2=$(echo $JWT | cut -d '.' -f 2)
          PART3=$(echo $JWT | cut -d '.' -f 3)
          
          echo "PART 1 (Header):"
          echo $PART1
          echo ""
          echo "PART 2 (Payload):"
          echo $PART2
          echo ""
          echo "PART 3 (Signature):"
          echo $PART3
          echo "--------------------------------------------------"
